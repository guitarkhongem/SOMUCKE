*       *********************************************************
*       *                                                         
*       * 08/13/99              SOMK.SPR                 15:14:19 
*       *                                                         
*       *********************************************************
*       *                                                         
*       * Author's Name                                           
*       *                                                         
*       * Copyright (c) 1999 Company Name                         
*       * Address                                                 
*       * City,     Zip                                           
*       *                                                         
*       * Description:                                            
*       * This program was automatically generated by GENSCRN.    
*       *                                                         
*       *********************************************************


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

m.rborder = SET("READBORDER")
SET READBORDER ON

m.currarea = SELECT()


*       *********************************************************
*       *                                                         
*       *               Windows Window definitions                
*       *                                                         
*       *********************************************************
*

IF NOT WEXIST("_s7i0wntle")
	DEFINE WINDOW _s7i0wntle ;
		AT  0.000, 0.000  ;
		SIZE 15.000,55.833 ;
		TITLE "Sæ môc kª" ;
		FONT ".VnTime", 10 ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		SYSTEM
	MOVE WINDOW _s7i0wntle CENTER
ENDIF


*       *********************************************************
*       *                                                         
*       *           SOMK/Windows Setup Code - SECTION 2           
*       *                                                         
*       *********************************************************
*

#REGION 1
clea
close all
set talk off
set safe off
set carr off
set defa to c:\ttgl
sele 1
use csdl alias csdl
SORT TO tamthoi.dbf ON Csdl.soto,Csdl.sothua,Csdl.st,Csdl.thuaphu FIELDS Csdl.tench,Csdl.soto,Csdl.sothua,Csdl.st,Csdl.thuaphu,Csdl.dtich,Csdl.tongdt,Csdl.lrd ,Csdl.dtsd ,Csdl.sttld
sele 1
   use tamthoi alias tg
do c:\hsbd\chuanbi.spr
close all
sele 1
use somucke
	 sele 10	
		  SELECT somucke.soto  FROM somucke  GROUP BY somucke.soto ORDER BY somucke.soto  INTO CURSOR tam
           publ dime shbd(recc())
           shbd=""
             for i=1 to recc()
               shbd(i)=soto
               skip
             endf

*********
publi timthay
timthay=.F.


*       *********************************************************
*       *                                                         
*       *               SOMK/Windows Screen Layout                
*       *                                                         
*       *********************************************************
*

#REGION 1
IF WVISIBLE("_s7i0wntle")
	ACTIVATE WINDOW _s7i0wntle SAME
ELSE
	ACTIVATE WINDOW _s7i0wntle NOSHOW
ENDIF
@ 2.600,17.833 SAY "IN Sæ MôC K£" ;
	FONT ".VnArialH", 12 ;
	STYLE "BT" ;
	COLOR RGB(0,0,255,,,,)
@ 9.533,14.500 SAY "In tê B§ sè :" ;
	FONT ".VnTime", 10 ;
	STYLE "T"
@ 11.133,13.333 SAY "B¾t ®Çu tõ trang :" ;
	FONT ".VnTime", 10 ;
	STYLE "T"
@ 4.400,6.000 GET radio ;
	PICTURE "@*RHN Ra mµn h×nh;Ra m¸y in" ;
	SIZE 1.308,16.667,0.667 ;
	DEFAULT 1 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "BT"
@ 5.733,6.167 GET chontrang ;
	PICTURE "@*RHN TÊt c¶;Trang ch¼n;Trang lÎ" ;
	SIZE 1.308,15.333,0.667 ;
	DEFAULT 1 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "BT"
@ 7.333,6.000 GET new ;
	PICTURE "@*C In quyÔn MK míi" ;
	SIZE 1.308,20.333 ;
	DEFAULT 0 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "BT" ;
	COLOR ,,,,,,,,RGB(255,0,0,,,,),RGB(255,0,0,,,,)
@ 7.333,30.000 GET ict ;
	PICTURE "@*C In chÝnh thøc" ;
	SIZE 1.308,17.333 ;
	DEFAULT 0 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "BT" ;
	COLOR ,,,,,,,,RGB(255,0,0,,,,),RGB(255,0,0,,,,)
@ 12.600,9.167 GET tt ;
	PICTURE "@*HN In c¸c trang" ;
	SIZE 1.769,13.667,0.667 ;
	DEFAULT 1 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "B" ;
	VALID _s7i0wntt3()
@ 12.600,24.167 GET tc ;
	PICTURE "@*HN In trang cuèi" ;
	SIZE 1.769,14.167,0.667 ;
	DEFAULT 1 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "B" ;
	VALID _s7i0wnttk()
@ 12.600,40.167 GET tr ;
	PICTURE "@*HT Tho¸t ra" ;
	SIZE 1.769,11.167,0.667 ;
	DEFAULT 1 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "B" ;
	VALID _s7i0wnttz()
@ 9.133,31.333 GET m_shbd ;
	PICTURE "@^" ;
	FROM shbd ;
	SIZE 1.538,12.400 ;
	DEFAULT 1 ;
	FONT ".VnTime", 8 ;
	STYLE "B"
@ 11.000,35.667 GET m_trang ;
	SIZE 1.000,5.333 ;
	DEFAULT 0 ;
	FONT ".VnTime", 10 ;
	PICTURE "@K"
@ 0.867,3.833 TO 2.400,52.000 ;
	PATTERN 1 ;
	PEN 1, 8 ;
	STYLE "16" ;
	COLOR RGB(255,255,0,192,192,192)
@ 1.000,5.167 SAY "TRUNG T¢M TT_LT §ÞA CHÝNH QU¶NG TRÞ" ;
	FONT ".VnTimeH", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,0,0,,,,)

IF NOT WVISIBLE("_s7i0wntle")
	ACTIVATE WINDOW _s7i0wntle
ENDIF

READ CYCLE

RELEASE WINDOW _s7i0wntle
SELECT (m.currarea)


#REGION 0

SET READBORDER &rborder

IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       *********************************************************
*       *                                                         
*       *                SOMK/Windows Cleanup Code                
*       *                                                         
*       *********************************************************
*

#REGION 1



*       *********************************************************
*       *                                                         
*       *    SOMK/Windows Supporting Procedures and Functions     
*       *                                                         
*       *********************************************************
*

#REGION 1
PROCEDURE TAOSMK
close all
use somucke
 copy to c:\hsbd\somucke for soto=shbd(m_shbd)
 sele 1
  use c:\hsbd\somucke
  count to npage
  m_tongtr=int(npage/44)+1
  ************
  *Tach ra tung trang
   If chontrang=3
     z=2
   else
     z=1
    endif
    do while z<= m_tongtr
          Public  nld,dime LdSo(12),dtld(12), dtldt(6),subdtldt(6,12),tongtrang
	         nLd=0
			LdSo=""
			dtld=0
			dtldt=0
			subdtldt=0
            tongtrang=0
      copy to c:\hsbd\somke for recn()>(z-1)*44 and recn()<=z*44
           sele 2
          use c:\hsbd\somke
          LOCA FOR lrd='§Êt ë' and dtich>200
           If found()
              timthay=.T.
              dttcnho=0
              dtv=0
              ldso(1)=lrd
              ldso(2)='V­ên    '
             count to d  for lrd='§Êt ë' and dtich>200
              nld=2
				sum(roun(dtich,0)) to Dttcnho for lrd='§Êt ë' and dtich<=200
				sum(roun(dtich,0)) to Dttclon for lrd='§Êt ë' and dtich>200
				sum(roun(dtich,0)) to Dtv for lrd='V­ên'
				dtlD(1)=Dttcnho+d*200
				Dtld(2)=dtv+Dttclon-d*200
                SubDtLdt(1,1)=dtlD(1)
                SubDtLdt(1,2)=dtlD(2)
              k=3
            else
              k=1
            Endif
            go top
	******************
			*Tim  mot loai dat moi
				scan  for lrd<>space(5)
					Flag=.T.
					for i=1 to nld+1
						if LdSo(i) == lrd
						  repl sttld with i
							Flag=.F.
							exit
						endif
					endfor
	            	 If  Flag 	&& tim thay mot loai dat moi
						nld=nld+1
						LdSo(nld)=lrd
						  repl sttld with nld
					endif
*				endif
				endscan
			**********

			sum(roun(dtich,0)) to tongDT
			if nLd >12
				nLd = 12
			endif
			for i = k to nld
				sum(roun(dtich,0)) to DtLd(i) for sttld = i
				tongtrang=tongtrang+dtld(i)
			endfor
			 If timthay
			   tongtrang=tongtrang+Dttcnho+Dttclon+dtv
			  endif
			for i = 1 to 6
					sum(roun(dtich,0)) to DtLdt(i) for dtsd=i
			endfor

			for i = 1 to 6
				for j = k to nLd
					sum(roun(dtich,0)) to SubDtLdt(i,j) for dtsd=i .and. sttld = j
			      endfor
			endfor
                   If radio=1
                   repo form c:\hsbd\somke prev
                   sele 2
                   use
                   else
                    repo form c:\hsbd\somke to prin noco
                   sele 2
                   use
                   endif
          If radio=1 and ict=1
                  sele 3
                      use c:\hsbd\cuoimk
                    IF new=1
                      zap
                     endif
                        loca for soto =m_shbd and trangso=m_trang
                           if ! foun()
	     		            for i = 1 to 6
						for j=1 to nld
						appe blan
						 repl dtich with SubDtLdt(i,j),lrd with ldso(j),dtsd with i ,soto with m_shbd   ,trangso with m_trang
			                  endfor
			           endfor
                          endif
                       dele for dtich=0
                     pack
                     new=0
           endif
 phim=lastkey()
  if phim<>27
    If chontrang=1
      z=z+1
      m_trang=m_trang+1
     else
      z=z+2
      m_trang=m_trang+2
   endif
  else
      z=m_tongtr+1
   endif
                  sele 1
         endd
retu
******
proce cuoimk
close all
dime dtsd(6)
dtsd(1)='Hé Gia ®×nh,C¸ thÓ'
dtsd(2)='UBND x·'
dtsd(3)='C¸c tæ chøc kinh tÕ'
dtsd(4)=''
dtsd(5)=''
dtsd(6)=''
crea tabl c:\hsbd\csmk (trangso n(3),tongtrang n(8),lrdso1 n(6),lrdso2 n(6),lrdso3 n(6),lrdso4 n(6),lrdso5 n(6),lrdso6 n(6),lrdso7 n(6),lrdso8 n(6),lrdso9 n(6),lrdso10 n(6),lrdso11 n(6),lrdso12 n(6),lrdso13 n(6),lrdso14 n(6),lrdso15 n(6),lrdso16
n(6),lrdso17 n(6))
use
  for j=1 to 6
    sele 6
     use c:\hsbd\csmk
    zap
sele 3
use c:\hsbd\cuoimk
  loca for dtsd=j
    If not found()
     j=j+1
     loop
    endif
    dime ldso(17)
	         nLd=0
			LdSo=""
			*Tim  mot loai dat moi
				scan  for lrd<>space(5) and dtsd=j
					Flag=.T.
					for i=1 to nld+1
						if LdSo(i) == lrd
						  repl sttld with i
							Flag=.F.
							exit
						endif
					endfor
	            	 If  Flag 	&& tim thay mot loai dat moi
						nld=nld+1
						LdSo(nld)=lrd
						  repl sttld with nld
					endif
				endscan
			**********
       go top
       m_trangso=0
         scan for dtsd=j
            If trangso<>m_trangso
             m_tongtrang=0
              sele 6
                appe blan
               sele 3
            endif
            for i=1 to nld
              if lrd==ldso(i)
                 i=allt(str(i))
                 m_trangso=trangso
                 m_tongtrang=m_tongtrang+dtich
                sele 6
                repl lrdso&i with cuoimk.dtich,trangso with cuoimk.trangso,tongtrang with m_tongtrang
                i=16
                sele 3
              endif
            endfor
         endscan
         sele 6
SORT TO c:\hsbd\thdtcsmk.dbf ON Csmk.trangso FIELDS ;
Csmk.trangso,Csmk.tongtrang,Csmk.lrdso1,Csmk.lrdso2,Csmk.lrdso3,Csmk.lrdso4,Csmk.lrdso5,Csmk.lrdso6,Csmk.lrdso7,Csmk.lrdso8,Csmk.lrdso9,Csmk.lrdso10,Csmk.lrdso11,Csmk.lrdso12,Csmk.lrdso13,Csmk.lrdso14,Csmk.lrdso15,Csmk.lrdso16,Csmk.lrdso17
sele 5
use  c:\hsbd\thdtcsmk.dbf
  if radio=1
      repo form c:\hsbd\thdt_smk.frx prev
    else
      repo form c:\hsbd\thdt_smk.frx to prin noco
   endif
      close all
      dele file c:\hsbd\thdtcsmk.dbf
  endfor
  clos all


*       *********************************************************
*       *                                                         
*       * _S7I0WNTT3           tt VALID                           
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         SOMK,     Record Number:    9      
*       * Variable:            tt                                 
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      1                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _s7i0wntt3     &&  tt VALID
#REGION 1
do taosmk

*       *********************************************************
*       *                                                         
*       * _S7I0WNTTK           tc VALID                           
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         SOMK,     Record Number:   10      
*       * Variable:            tc                                 
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      2                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _s7i0wnttk     &&  tc VALID
#REGION 1
do cuoimk

*       *********************************************************
*       *                                                         
*       * _S7I0WNTTZ           tr VALID                           
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         SOMK,     Record Number:   11      
*       * Variable:            tr                                 
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      3                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _s7i0wnttz     &&  tr VALID
#REGION 1
close all
dele file tam.dbf
dele file c:\hsbd\somke.dbf
dele file c:\hsbd\somucke.dbf
dele file c:\hsbd\csmk.dbf
dele file c:\hsbd\thdtcsmk.dbf
set defa to c:\hsbd